{% load custom_tags %}
{% load crispy_forms_tags %}

<h5>Checks summary</h5>
<table class="table table-sm table-hover">
  <thead>
    <tr>
      <th class="col-2">Check</th>
      <th class="col-3">Full classification</th>
      <th class="col-3">Class</th>
      <th class="col-4">User</th>
    </tr>
  </thead>
  <tbody>
  {% for c in classification_info.all_checks %}
    <tr>
      <td>
        {{ forloop.counter }}
        {% if classification_info.classification_obj.get_status != "Complete" and c == classification_info.current_check %}
        <span class="badge badge-pill badge-warning">Current</span>
        {% endif %}
      </td>
      <td>{{ c.classification.full_classification }}</td>
      <td>
        {% if c.get_final_class_display %}
        <span class="badge badge-pill badge-{{ c.get_final_class_display|colour_by_class }}">{{ c.get_final_class_display }} ({{ c.final_score }})</span>
        {% if c.final_class_overridden %}<span class="badge badge-pill badge-warning">Overridden</span>{% endif %}
        {% else %}
        Pending
        {% endif %}
      </td>
      <td>{{ c.user }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<br>
<br>


{% if classification_info.classification_obj.get_status != "Complete" %}

  <div class="card-body bg-light">
    <h5>Finalise check</h5>
    {% crispy forms.finalise_form %}
  </div>

{% else %}
  <h5>Final classification</h5>
  <button class="btn btn-block btn-lg btn-disabled btn-{{ classification_info.current_check.get_final_class_display|colour_by_class }}" type="button">
    <b>{{ classification_info.current_check.get_final_class_display }}</b>&nbsp;
    <span class="badge badge-light">
        {{ classification_info.current_check.final_score }}
        {% if classification_info.current_check.final_class_overridden %} - overridden{% endif %}
    </span>
  </button>
  <br>
  <br>

  <div class="alert alert-warning">
    <h5>Analysis complete!</h5>
    <p>
      Analysis for this variant has been completed. <a href="" data-toggle="modal" data-target="#reopen_analysis_modal">Click here to reopen</a>
    </p>
  </div>

{% endif %}



<!-- Reopen modal -->
<div class="modal fade" id="reopen_analysis_modal" tabindex="-1" aria-labelledby="reopen_analysis_modal_label" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="reopen_analysis_modal_label">Reopen?</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="alert alert-danger">
          <p><b>Warning!</b> Analysis for this variant is complete, this will reopen analysis from the finalise tab of the last checker</p>
        </div>
        {% crispy forms.reopen_analysis_form %}
      </div>
    </div>
  </div>
</div>
