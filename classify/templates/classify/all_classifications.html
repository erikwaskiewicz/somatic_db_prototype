{% extends 'analysis/base.html' %}
{% load custom_tags %}
{% load crispy_forms_tags %}

{% block breadcrumbs %}
<div class="container-fluid breadcrumbs-custom">
  <div class="container">
    <ol class="breadcrumb" style="background-color: transparent;">
      <li class="breadcrumb-item active"><a href="{% url 'home' %}"><span class="fa fa-home"></span></a></li>
      <li class="breadcrumb-item"><a href="{% url 'view-all-classifications' %}">Classify</a></li>
    </ol>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="container">
    <h5>Variant classification</h5>
    <br>
    <table class="table" id="classifications-table">
      <thead>
        <tr>
          <th class="col-1">ID</th>
          <th class="col-2">Gene</th>
          <th class="col-3">Variant</th>
          <th class="col-2">Tumour type</th>
          <th class="col-1">Guidelines</th>
          <th class="col-4">Status</th>
        </tr>
      </thead>
      <tbody>
        {% for c in classifications %}
        <tr>
          <td>{{ c.pk }}</td>
          <td>{{ c.variant.gene }}</td>
          <td>{{ c.variant.hgvs_c }}<br>{{ c.variant.hgvs_p }}</td>
          <td>{{ c.get_sample_info.svd_panel }}</td>
          <td><h4><span class="badge badge-{{ c.somatic_or_germline|colour_by_guideline }}">{{ c.guideline }}</span></h4></td>
          <td>
            {% if c.get_status == "Complete" %}
            <a class="btn btn-secondary w-100" href="{% url 'perform-classification' c.pk %}" role="button">Complete<br>&nbsp;</a>
            {% elif c.get_latest_check.user == None %}
            <a class="btn btn-primary w-100" href="{% url 'perform-classification' c.pk %}" role="button">{{ c.get_status }}<br>Pending - Assign to me</a>
            {% elif c.get_latest_check.user == request.user %}
            <a class="btn btn-primary w-100" href="{% url 'perform-classification' c.pk %}" role="button">{{ c.get_status }}<br>Assigned to me</a>
            {% else %}
            <a class="btn btn-primary w-100 disabled" href="{% url 'perform-classification' c.pk %}" role="button">{{ c.get_status }}<br>Assigned to {{ c.get_latest_check.user }}</a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
    <br>
    <br>
  
    {% crispy new_form %}
  </div>


<script>
    $(document).ready( function() {

        // Inititialise DataTable
        $('#classifications-table').DataTable({
            paging: true,
            columns: [
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: true},
                {orderable: true},
            ],
            info: true,
            pageLength: 10,
            searching: true,
            aaSorting: [],
            language: {
                searchPlaceholder: "Search",
                search: "",
            },
            initComplete: function () {
                $('.dataTables_filter input[type="search"]').css({ 'width': '500px', 'display': 'inline-block' });
            }
        });
    } );
</script>

{% endblock %}